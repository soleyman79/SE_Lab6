# آزمایش ششم: Docker
# پاسخ پرسش‌ها

# مراحل آزمایش
در این آزمایش، همانطور که در دستور کار گفته شده است، باید یک سیستم نرم‌افزاری مبتنی بر معماری Microservice و بر بستر Docker ساخته شود. سیستمی که برای این آزمایش در نظر گرفته شده است، یک کتابخانه ساده است که در آن ۳ سرویس و منطق مجزا وجود دارد. سرویس اول برای مدیریت امور کتاب‌ها و ویژگی‌های آنهاست. سرویس دوم برای مدیریت کاربران و مشترکین کتابخانه است و در نهایت، سرویس آخر مختص به امانت‌گیری کتاب‌ها توسط کابران است. پیش از اینکه به توضیح دقیق و تفصیلی این سرویس‌ها پرداخته شود، ابتدا نحوه استقرار پروژه بر Docker توضیح داده می‌شود. هر کدام از این 3 سرویس و منطق مجزا، یک image مخصوص به خود را دارد تا اگر بعدا قرار شد تغییری در سرویس‌ها داده شود یا سرویس‌ها تقویت شوند، فقط لازم باشد که image مربوط به آن سرویس تغییر کند یا duplicate شود.

## قسمت اول، توضیح استقرار نرم‌افزار بر Docker

در ادامه، برای هر سرویس، تصویر ساخته شدن موفقیت‌آمیز image آن سرویس و در ادامه، نتیجه اجرا شدن آن image و ساخته شدن یک container نشان داده شده است. ابتدا سرویس مربوط به امور کاربران نشان داده شده است:

![1](https://github.com/soleyman79/SE_Lab6/assets/59166192/cf47593b-f05d-4653-89ca-fcc70c48ac90)

سرویس بعد، سرویس مربوط به امانت‌گیری کتاب‌ها است:

![2](https://github.com/soleyman79/SE_Lab6/assets/59166192/434e6091-04df-4a50-8e11-4b2cdd89cb16)

به علت اختصار از آوردن تصویر image مربوط به سرویس مدیریت کتاب‌ها و ویژگی‌های آنها خودداری شده است. در قدم بعد، به کمک دستور ```docker ps``` تمام containerهای در حال اجرا نمایش داده می‌شوند و همچنین به کمک دستور ```docker image``` تمام imageهای ساخته شده در سیستم نمایش داده می‌شوند که اولین image نمایش داده شده، متعلق به این آزمایش است:

![3](https://github.com/soleyman79/SE_Lab6/assets/59166192/ba11a89d-9132-48a8-81d1-0d1fad360277)


## قسمت دوم، توضیح دقیق‌تر سرویس‌ها و APIهای آنها
همانطور که پیشتر گفته شد، ۳ سرویس برای این آزمایش در نظر گرفته شده است. در ادامه به توضیح هر کدام از عملیات‌های CRUD یا همان (Create - Read - Update - Delete) پرداخته می‌شود:

### سرویس اول، مدیریت کتاب‌ها

در تصویر زیر، عملیات create برای هر کتاب با نوع درخواست post نشان داده شده است که در payload مربوط به request ایجاد کتاب، نام و تعداد صفحات داده می‌شود. همچنین در این آزمایش برای سادگی فرض شده است که نام کتاب‌ها یکتا می‌باشد:

![1](https://github.com/soleyman79/SE_Lab6/assets/59166192/26f40e91-bfd1-438e-b08c-c6004fa5fcc9)

در تصویر زیر، عملیات read مربوط کتاب‌ها با درخواست نوع get نشان داده شده است و با دادن نام کتاب به عنوان بخشی از url درخواست، می‌توان اطلاعات کتاب را مشاهده کرد:

![2](https://github.com/soleyman79/SE_Lab6/assets/59166192/c166230a-ed35-4818-8797-bec360bda3ee)

در تصویر زیر، عملیات به روزرسانی کتاب‌ها با درخواست put انجام می‌شود و اطلاعات جدید از کتاب به عنوان payload وارد می‌شوند:

![3](https://github.com/soleyman79/SE_Lab6/assets/59166192/a818c77c-6595-46bb-9ef8-4b59f0f9f0e6)

در نهایت، عملیات delete کتاب‌ها با درخواست نوع delete، به صورت زیر انجام می‌شود. این درخواست، نام کتاب را به عنوان بخشی از پارامترهای خود دریافت می‌کند و اگر عملیات پاکسازی موفقیت‌آمیز باشد، هیچ پاسخی برگردانده نمی‌شود، اما اگر مطابق شکل زیر درخواست موفقیت‌آمیز نباشد و کتاب یا وجود نداشته باشد یا قبلا پاک شده باشد، یک پاسخ Not Found برگردانده می‌شود:

![4](https://github.com/soleyman79/SE_Lab6/assets/59166192/1b79e2c0-0ae3-48bc-a088-8b84b1451a54)

### سرویس دوم، مدیریت کاربران
در بخش اول، درخواست مروبط به ساخت یک کاربر جدید نشان داده می‌شود. این درخواست که از نوع post است، username را به عنوان بدنه درخواست می‌پذیرد و در صورتی که کاربری با این نام کاربری از قبل وجود داشته باشد، یک پاسخ خطا ارسال می‌شود.

![5](https://github.com/soleyman79/SE_Lab6/assets/59166192/d3259e70-cb1b-4d4f-9ba2-8f602692d257)

در ادامه عملیات مربوط به خواندن که با درخواست get انجام می‌شود، توضیح داده می‌شود. این درخواست، نام کاربری کاربر را به عنوان بخشی از url خود دریافت می‌کند و جزئیات اطلاعات مربوط به کاربر را بر می‌گرداند. در صورتی که مانند تصویر زیر، کاربر هنوز جزئیاتی نداشته باشد، پاسخ Not Found ارسال می‌شود:

![6](https://github.com/soleyman79/SE_Lab6/assets/59166192/80965e56-0226-4a3b-af11-f84ad829f774)

در تصویر زیر، عملیات مربوط به به‌روز‌رسانی اطلاعات کاربر با درخواست نوع put انجام می‌شود و اطلاعات جدید، در payload درخواست داده می‌شوند:

![7](https://github.com/soleyman79/SE_Lab6/assets/59166192/ee0ab2bd-855e-44b4-9c26-f4d6a22101fd)

و در آخر، دستور پاک کردن کاربر که از نوع درخواست delete است، با درخواست زیر انجام می‌شود و نام کاربری در بخشی از url دریافت می‌شود. اگر مانند تصویر زیر، مشکلی وجود نداشته باشد و اطلاعات کاربر با موفقیت پاک شود، هیچ پاسخی برگردانده نمی‌شود:

![8](https://github.com/soleyman79/SE_Lab6/assets/59166192/9d061efe-7a0e-4d68-b25f-c58946c8a96f)

### سرویس سوم، مدیریت امانت گرفتن کتاب‌ها
در بخش اول، درخواست مروبط به ساخت یک درخواست قزض گرفتن  جدید نشان داده می‌شود. این درخواست که از نوع post است، نام کاربری کاربر و نام کتاب را به عنوان بدنه درخواست می‌پذیرد و در صورت موفقیت، اطلاعات و تاریخ امانت گرفتن در پاسخ برگردانده می‌شود:

![9](https://github.com/soleyman79/SE_Lab6/assets/59166192/ecb197bc-0cf2-444d-b543-3ee03f7feb7f)


در ادامه یکی از انواع عملیات مربوط به خواندن اطلاعات امانت گرفتن که با درخواست get انجام می‌شود، توضیح داده می‌شود. این درخواست، نام کتاب را به عنوان بخشی از url خود دریافت می‌کند و جزئیات اطلاعات مربوط به کتاب امانت گرفته شده، نظیر نام امانت‌گیرنده و تاریخ را بر می‌گرداند.

![10](https://github.com/soleyman79/SE_Lab6/assets/59166192/c6c1b820-0232-44b7-8934-744449f50354)

نوع دیگری که از درخواست خواندن اطلاعات مربوط به امانت گرفتن وجود دارد، این است که نام کاربر به جای نام کتاب ورودی داده شود و جزئیات امانت گرفتن‌های آن کاربر در پاسخ داده شود:

![11](https://github.com/soleyman79/SE_Lab6/assets/59166192/763010a7-a090-420d-a8a5-e1de721b0284)

در تصویر زیر، عملیات مربوط به به‌روز‌رسانی اطلاعات امانت گرفتن با درخواست نوع put انجام می‌شود (نام کتاب در بخشی از url درخواست، داده می‌شود) و اطلاعات جدید (نام کاربر جدیدی که می‌خواهد کتاب را امانت بگیرد )، در payload درخواست داده می‌شوند:

![12](https://github.com/soleyman79/SE_Lab6/assets/59166192/2bfe0f55-519e-4981-8cd5-5686c5a5d940)

مجددا نوع دیگری که از درخواست به‌روز‌رسانی اطلاعات مربوط به امانت گرفتن وجود دارد، این است که نام کاربر به جای نام کتاب در بخشی از url درخواست، ورودی داده شود و در پاسخ، امانت گرفتن‌ آن کاربر به‌روز‌رسانی شود:

![13](https://github.com/soleyman79/SE_Lab6/assets/59166192/df9a722d-965e-4f06-8bb8-2e1d44cc469b)

و در آخر، دستور پاک کردن عملیات امانت گرفتن است و به این صورت عمل می‌کند که یا با نام امانت‌گیرنده و یا با نام کتاب به عنوان بخشی از url این درخواست، می‌تواند آن تاریخچه امانت گرفتن را پاک کرد. اگر این عملیات موفقیت‌آمیز باشد، هیچ پاسخی برگردانده نمی‌شود:

![1402-06-03 14 30 37](https://github.com/soleyman79/SE_Lab6/assets/59166192/05897322-dddb-488b-bedd-451891dd2fa7)

در ادامه، چون قبلا سابقه امانت‌گیری کتاب DNS و به همراه آن، سابقه امانت‌گیرنده این کتاب یعنی user2 پاک شده است، اگر این درخواست دوباره زده شود، در پاسخ Not Found داده می‌شود:

![15](https://github.com/soleyman79/SE_Lab6/assets/59166192/fbe6fd17-9c97-42b8-9ba4-e60a5460d873)

## قسمت سوم، توضیح تعادل بار (Load Balancing):

این بخش به کمک یک ویدیو از نحوه کار سیستم توضیح داده شده است:

https://github.com/soleyman79/SE_Lab6/assets/59166192/f9ca7f9e-6238-42b2-b1c9-34bf16049623

علاوه بر ویدیوی بالا، تصاویر و توضیحات این بخش در ادامه خواهد آمد.
عملیات تعدیل بار در این آزمایش توسط nginx انجام شده است، به این صورت که ۳ نمونه از سرور با ۳ پورت مختلف فعال و مستقر شده است. پورت‌‌های سرورها به صورت 8000، 8001 و 8003 هستند، که این ۳ نمونه در تصویر زیر مشخص هستند. قسمت بالا و سمت چپ تصویر زیر نیز localhost پروژه است:

![20](https://github.com/soleyman79/SE_Lab6/assets/59166192/9670ed37-2b7b-4507-b7ce-3549987021a7)


در ادامه، یک ریکوئست زده شده است و همانطور که در تصویر زیر مشخص است، این ریکوئست روی پورت 8003 رفته است و در آنجا هندل شده است.

![21](https://github.com/soleyman79/SE_Lab6/assets/59166192/94037fe4-3e29-47d9-a631-145455c9aed1)

در تصویر زیر، مجددا یک ریکوئست زده شده است و این بار، توسط پورت 8001 دریافت و بررسی شده است.

![22](https://github.com/soleyman79/SE_Lab6/assets/59166192/660ef187-f789-4330-b9bd-7c2150b6e119)

در تصویر زیر، دوباره یک ریکوئست دیگر زده شده است و این بار، درخواست توسط پورت 8000 دریافت و بررسی شده است.

![23](https://github.com/soleyman79/SE_Lab6/assets/59166192/3c462a4d-a812-4bff-b620-d8a17fb58548)

الان یک چرخه کامل طی شده و در طی 3 درخواست، هر بار یکی از پورت‌ها به درخواست رسیدگی کرده است. در ادامه یک درخواست دیگر زده می‌شود و مجددا مشاهده می‌شود که این درخواست دوباره روی پورت 8003 رفته است و آنجا هندل شده است:

![24](https://github.com/soleyman79/SE_Lab6/assets/59166192/dac49357-3271-40a5-842e-b12af7ff7450)












